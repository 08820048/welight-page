# Welight 主题开发实践指南

> 本指南基于 Welight 主题开发规范 v1.0，提供从零开始开发主题的完整实践流程和最佳实践。

## 📋 目录

- [快速开始](#快速开始)
- [主题配置详解](#主题配置详解)
- [样式开发规范](#样式开发规范)
- [核心元素样式](#核心元素样式)
- [兼容性保证](#兼容性保证)
- [测试与发布](#测试与发布)
- [常见问题](#常见问题)

---

## 🚀 快速开始

### 第一步：创建主题文件

在 `src/themes/` 目录下创建新的主题文件，建议使用四个字的中文命名：

```bash
src/themes/你的主题.js
```

### 第二步：使用模板

复制 `src/themes/templates/_template.js` 作为起点：

```javascript
export default {
  // 基础信息
  name: '你的主题',
  description: '简要描述你的主题风格与适用场景',
  category: 'minimal', // minimal|business|creative|elegant|tech|warm|nature|chinese
  author: 'Your Name',
  version: '1.0.0',

  // 预览与颜色
  preview: {
    primaryColor: '#2d6cdf',
    secondaryColor: '#f5f7fa',
    accentColor: '#333'
  },

  colors: {
    primary: '#2d6cdf',
    secondary: '#f5f7fa',
    accent: '#333',
    text: '#333',
    background: '#fff',
    border: '#e5e7eb',
    quote: '#f8f9fa'
  },

  // 功能配置
  customListSupport: true,
  features: {
    customListSupport: true,
    macCodeBlock: false,
    codeLineNumbers: false
  },

  // CSS 样式
  styles: `/* 你的样式代码 */`
}
```

### 第三步：注册主题

在 `src/themes/index.js` 中导入并注册你的主题：

```javascript
import 你的主题 from './你的主题.js'

export const themes = [
  // ... 其他主题
  你的主题
]
```

---

## 📐 主题配置详解

### 1. 基础信息（必填）

```javascript
{
  name: '主题名称',           // 唯一标识，与 CSS 命名空间一致
  description: '主题描述',    // 简短描述，50字以内
  category: 'minimal',        // 主题分类
  author: '作者名',           // 作者信息
  version: '1.0.0'           // 版本号，遵循语义化版本
}
```

**主题分类说明：**

- `minimal` - 简约风格
- `business` - 商务风格
- `creative` - 创意风格
- `elegant` - 典雅风格
- `tech` - 科技风格
- `warm` - 温馨风格
- `nature` - 自然风格
- `chinese` - 中国风

### 2. 预览配置（必填）

```javascript
preview: {
  primaryColor: '#2d6cdf',    // 主色调，用于主题选择器预览
  secondaryColor: '#f5f7fa',  // 辅助色
  accentColor: '#333'         // 强调色
}
```

**颜色选择建议：**

- 使用十六进制颜色值
- 确保主色调与主题风格一致
- 考虑色彩对比度和可读性

### 3. 颜色方案（必填）

```javascript
colors: {
  primary: '#2d6cdf',      // 主色调：标题、链接等
  secondary: '#f5f7fa',    // 辅助色：背景、边框等
  accent: '#333',          // 强调色：重点内容
  text: '#333',            // 文本色：正文
  background: '#fff',      // 背景色：容器背景
  border: '#e5e7eb',       // 边框色：分割线
  quote: '#f8f9fa'         // 引用色：引用块背景
}
```

### 4. 功能配置（必填）

```javascript
// 兼容期字段（同时保留两处）
customListSupport: true,
features: {
  customListSupport: true,   // 启用自定义列表支持
  macCodeBlock: false,       // Mac 风格代码块
  codeLineNumbers: false     // 代码块行号
}
```

### 5. 可选配置

```javascript
// 背景配置
background: {
  type: 'none'  // none|solid|pattern-grid|pattern-dots|image
},

// 字体配置
fonts: {
  base: "-apple-system, 'Segoe UI', Roboto, sans-serif",
  heading: '',
  code: "'SF Mono', 'Consolas', monospace"
},

// 间距配置
spacing: {
  paragraph: '14px',
  heading: '20px'
}
```

---

## 🎨 样式开发规范

### 核心原则

1. **命名空间隔离**：所有样式必须以 `.preview-container.主题名` 开头
2. **微信优先**：确保在微信公众号编辑器中正常显示
3. **简洁性**：避免使用复杂的 CSS 特性
4. **真实元素**：装饰性元素使用真实 HTML，不用伪元素

### 命名空间规范

```css
/* ✅ 正确：使用命名空间 */
.preview-container.你的主题 h1 {
  color: #2d6cdf;
}

/* ❌ 错误：裸选择器污染全局 */
h1 {
  color: #2d6cdf;
}
```

### 选择器深度

```css
/* ✅ 推荐：深度 ≤ 4 */
.preview-container.你的主题 .list .list-item .content {
  /* 样式 */
}

/* ❌ 不推荐：深度过深 */
.preview-container.你的主题 section div ul li span a {
  /* 样式 */
}
```

---

## 📝 核心元素样式

### 1. 容器样式

```css
.preview-container.你的主题 {
  max-width: 800px;
  margin: 0 auto;
  padding: 24px;
  line-height: 1.7;
  color: #333;
  background-color: #fff;
  font-family: -apple-system, 'Segoe UI', Roboto, sans-serif;
}
```

**注意事项：**

- 设置合理的最大宽度（推荐 750-900px）
- 使用相对单位（em、rem）或百分比
- 设置适当的内边距（20-40px）

### 2. 标题样式

```css
/* H1 标题 */
.preview-container.你的主题 h1 {
  font-size: 28px;
  font-weight: 700;
  margin: 32px 0 20px;
  border-left: 6px solid var(--primary, #2d6cdf);
  padding: 12px 16px;
  background: #f6f8fa;
  border-radius: 6px;
}

/* H2 标题 */
.preview-container.你的主题 h2 {
  font-size: 22px;
  font-weight: 600;
  margin: 24px 0 16px;
  border-left: 4px solid var(--primary, #2d6cdf);
  padding: 8px 12px;
  background: #f8f9fa;
  border-radius: 4px;
}

/* H3 标题 */
.preview-container.你的主题 h3 {
  font-size: 18px;
  font-weight: 600;
  margin: 20px 0 12px;
  padding-left: 10px;
  border-left: 3px solid var(--primary, #2d6cdf);
}
```

**设计建议：**

- H1-H6 字号递减，保持层级关系
- 使用边框、背景等区分标题层级
- 保持适当的上下边距

### 3. 段落样式

```css
.preview-container.你的主题 p {
  margin: 14px 0;
  line-height: 1.8;
  text-align: justify;
}
```

### 4. 列表样式（重要）

**必须使用嵌套 section 结构：**

```css
/* 列表容器 */
.preview-container.你的主题 .list {
  margin: 16px 0;
}

/* 列表项 */
.preview-container.你的主题 .list-item {
  display: flex;
  gap: 8px;
  align-items: flex-start;
  margin: 10px 0;
}

/* 序号/符号 */
.preview-container.你的主题 .list-item .prefix {
  flex: 0 0 auto;
  min-width: 20px;
  text-align: center;
  margin-top: 2px;
  color: var(--primary, #2d6cdf);
  font-weight: 600;
}

/* 内容 */
.preview-container.你的主题 .list-item .content {
  flex: 1 1 auto;
}

/* 有序列表特殊样式 */
.preview-container.你的主题 .list.ordered .list-item {
  border-left: 2px solid #e5e7eb;
  padding-left: 12px;
}

/* 无序列表特殊样式 */
.preview-container.你的主题 .list.unordered .prefix {
  color: var(--primary, #2d6cdf);
}
```

**❌ 禁止使用伪元素：**

```css
/* ❌ 错误：伪元素在微信中不显示 */
.preview-container.你的主题 ul li::before {
  content: '●';
}

/* ❌ 错误：::marker 不兼容 */
.preview-container.你的主题 ul li::marker {
  content: '■';
}
```

### 5. 代码块样式（强制规范）

```css
/* 代码块容器 - 仅布局，禁止设置背景和颜色 */
.preview-container.你的主题 pre {
  overflow-x: auto !important;
  overflow-y: hidden !important;
  white-space: pre !important;
  text-wrap: nowrap !important;
  padding: 16px;
  margin: 16px 0;
  border: 1px solid rgba(0, 0, 0, 0.06);
  border-radius: 8px;
  font-family: 'SF Mono', 'Consolas', monospace;
  font-size: 14px;
  line-height: 1.6;
  /* ❌ 禁止设置 background 和 color */
}

/* 代码内容 */
.preview-container.你的主题 pre code {
  display: inline;
  padding: 0;
  background: transparent;
  color: inherit;
  font: inherit;
  white-space: inherit;
}

/* 滚动条美化（可选） */
.preview-container.你的主题 pre code::-webkit-scrollbar {
  height: 8px;
}

.preview-container.你的主题 pre code::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.05);
  border-radius: 4px;
}

.preview-container.你的主题 pre code::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.25);
  border-radius: 4px;
}
```

**关键要点：**

- ✅ 必须设置 `overflow-x: auto !important`
- ✅ 必须设置 `white-space: pre !important`
- ❌ 禁止设置 `background` 和 `color`（由代码高亮主题控制）
- ✅ 可以设置 padding、margin、border、font-family 等布局属性

### 6. 行内代码样式

```css
.preview-container.你的主题 code:not(pre code) {
  background: #f6f8fa;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: 'SF Mono', 'Consolas', monospace;
  font-size: 0.9em;
  color: #d73a49;
}
```

### 7. 引用块样式

```css
.preview-container.你的主题 blockquote {
  border-left: 4px solid var(--primary, #2d6cdf);
  background: #f8fafc;
  padding: 12px 16px;
  margin: 16px 0;
  color: #666;
  font-style: italic;
}
```

### 8. 表格样式

```css
.preview-container.你的主题 table {
  width: 100%;
  border-collapse: collapse;
  margin: 16px 0;
}

.preview-container.你的主题 th,
.preview-container.你的主题 td {
  border: 1px solid #e5e7eb;
  padding: 8px 10px;
  text-align: left;
}

.preview-container.你的主题 th {
  background: #f6f8fa;
  font-weight: 600;
  color: var(--primary, #2d6cdf);
}

.preview-container.你的主题 tr:nth-child(even) {
  background: #f9fafb;
}
```

### 9. 链接样式

```css
.preview-container.你的主题 a {
  color: var(--primary, #2d6cdf);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s;
}

.preview-container.你的主题 a:hover {
  border-bottom-color: var(--primary, #2d6cdf);
}
```

### 10. 分割线样式

```css
.preview-container.你的主题 hr {
  border: none;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    #e5e7eb,
    transparent
  );
  margin: 24px 0;
}
```

---

## ✅ 兼容性保证

### 微信公众号兼容性清单

#### ✅ 可以使用的 CSS 特性

```css
/* 基础样式 */
color, background-color, font-size, font-weight, font-family
padding, margin, border, border-radius
text-align, line-height, letter-spacing

/* 简单效果 */
box-shadow: 0 2px 4px rgba(0,0,0,0.1);  /* 简单阴影 */
border-radius: 8px;                      /* 圆角 */
background: linear-gradient(...);        /* 简单渐变 */
```

#### ❌ 禁止使用的 CSS 特性

```css
/* 伪元素（重要内容） */
::before, ::after, ::marker

/* 复杂效果 */
filter: drop-shadow();
backdrop-filter: blur();
clip-path: polygon();
mask: url();
transform: rotate3d();

/* 复杂渐变 */
background: conic-gradient();
background: repeating-radial-gradient();
```

### 图标实现方案

**❌ 错误方式：使用伪元素**

```css
/* 不要这样做 */
.preview-container.你的主题 ul li::before {
  content: '🌱';
}
```

**✅ 正确方式：使用真实 HTML 元素**

主题只需定义样式，图标由系统自动插入：

```css
/* 在主题中定义图标样式 */
.preview-container.你的主题 .theme-list-icon {
  color: #2d6cdf;
  margin-right: 8px;
}
```

在 `src/App.vue` 的 `addThemeIcons` 函数中配置图标：

```javascript
const themeIcons = {
  '你的主题': {
    listIcon: '🎯',        // 列表项图标
    h1Icon: '🎨',          // H1标题前图标
    h1IconAfter: '✨',     // H1标题后图标（可选）
    quoteIcon: '💬'        // 引用块图标（可选）
  }
}
```

---

## 🧪 测试与发布

### 测试清单

#### 1. 开发前准备

- [ ] 确定主题风格和适用场景
- [ ] 设计色彩搭配方案
- [ ] 准备测试用的 Markdown 内容

#### 2. 样式开发

- [ ] 实现 H1-H6 标题样式
- [ ] 实现段落和文本样式
- [ ] 实现列表样式（使用嵌套 section 结构）
- [ ] 实现代码块样式（遵循规范）
- [ ] 实现引用块样式
- [ ] 实现表格样式
- [ ] 实现链接和强调样式
- [ ] 实现分割线样式

#### 3. 兼容性测试

- [ ] 在 Chrome 浏览器中测试
- [ ] 在 Safari 浏览器中测试
- [ ] 在微信公众号编辑器中测试
- [ ] 在手机端微信中测试
- [ ] 复制粘贴功能测试

#### 4. 代码质量

- [ ] CSS 代码格式规范
- [ ] 颜色值使用配置中的变量
- [ ] 类名遵循命名规范
- [ ] 注释清晰完整

### 测试文档模板

创建测试文档 `你的主题测试.md`：

````markdown
# 主题测试文档

## 二级标题测试

### 三级标题测试

这是普通段落文本，用于测试段落样式和行间距。

**粗体文本** 和 *斜体文本* 测试。

### 列表测试

无序列表：
- 列表项 1
- 列表项 2
- 列表项 3

有序列表：
1. 第一步
2. 第二步
3. 第三步

### 代码测试

行内代码：`const hello = 'world'`

代码块：
```javascript
function greet(name) {
  console.log(`Hello, ${name}!`);
}
```

### 引用测试

> 这是一段引用内容，用于测试引用块的样式效果。

### 表格测试

| 功能 | 描述 | 状态 |
|------|------|------|
| 主题切换 | 支持多种主题 | ✅ |
| 样式复制 | 一键复制到微信 | ✅ |

### 链接测试

[这是链接文本](https://example.com)

---

分割线测试
````

### 发布流程

1. **本地测试通过**

2. **提交代码**

   ```bash
   git add src/themes/你的主题.js
   git commit -m "新增主题：你的主题"
   ```

3. **更新文档**

   - 在 `src/themes/README.md` 中添加主题说明
   - 更新主题列表

4. **推送代码**

   ```bash
   git push origin main
   ```

---

## ❓ 常见问题

### Q1: 为什么列表图标在微信中不显示？

**A:** 因为使用了 CSS 伪元素（`::before`、`::after`）。微信公众号编辑器对伪元素支持有限。

**解决方案：**

- 使用嵌套 section 结构
- 启用 `customListSupport: true`
- 在 `addThemeIcons` 中配置图标

### Q2: 代码块复制到微信后没有滚动条？

**A:** 因为没有遵循代码块样式规范。

**解决方案：**

- 必须设置 `overflow-x: auto !important`
- 必须设置 `white-space: pre !important`
- 不要设置 `background` 和 `color`

### Q3: 主题在预览中正常，但复制到微信后样式丢失？

**A:** 可能使用了微信不支持的 CSS 特性。

**解决方案：**

- 避免使用复杂的 CSS 特性
- 使用基础的、广泛支持的属性
- 参考兼容性清单

### Q4: 如何实现背景图案？

**A:** 使用 `background` 配置，不要在主题样式中直接设置。

**示例：**

```javascript
background: {
  type: 'pattern-grid',
  patternColor: '#e5e7eb',
  patternBackgroundColor: '#ffffff',
  patternSize: 20
}
```

### Q5: 主题颜色如何使用变量？

**A:** 使用 CSS 变量或直接引用 colors 配置。

**示例：**

```css
.preview-container.你的主题 h1 {
  color: var(--primary, #2d6cdf);
  /* 或直接使用颜色值 */
  color: #2d6cdf;
}
```

---

## 📚 参考资源

### 官方文档

- [主题开发规范](./主题开发规范.md) - 完整的开发规范
- [主题开发文档](./主题开发文档.md) - 详细的技术文档
- [公众号主题开发规则](../公众号主题开发规则.md) - 兼容性指南
- [主题图标开发指南](./主题图标开发指南.md) - 图标实现方案

### 示例主题

- `src/themes/苹果简约.js` - 简约风格参考
- `src/themes/商务简约.js` - 商务风格参考
- `src/themes/templates/_template.js` - 官方模板

### 工具和资源

- [背景样式合集](./背景样式合集.md) - 背景图案参考
- [Markdown 语法指南](./markdown-syntax-guide.md) - Markdown 语法
- [复制功能指南](./copy-guide.md) - 复制功能说明

---

## 🎯 最佳实践总结

1. **从模板开始**：使用官方模板作为起点
2. **遵循规范**：严格遵守主题开发规范
3. **微信优先**：优先考虑微信公众号兼容性
4. **简洁设计**：避免过度复杂的样式
5. **充分测试**：在多个平台和设备上测试
6. **清晰注释**：添加详细的代码注释
7. **参考示例**：学习现有优秀主题的实现

---

**祝你开发出优秀的主题！** 🎉

如有问题，请参考官方文档或查看示例主题代码。

